#!/usr/bin/env python3

import os, argparse, hashlib

ap = argparse.ArgumentParser()
ap.add_argument("--name")
ap.add_argument("--url")
args = ap.parse_args()

with open("/app/lsoed.cfg", "w") as f:
    f.write("[lsoe]\n")
    if args.name:
        f.write("local-id = {}\n".format(
            hashlib.md5((open("/sys/class/dmi/id/product_uuid").read() + args.name).encode("ascii")).digest()[:10]))
    if args.url:
        f.write("report-rfc7752-url = {}\n".format(args.url))

if os.path.exists("/app/blocked"):
    os.unlink("/app/blocked")
